<!DOCTYPE html>
<html>
	<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<title> Version &middot; The OOC Manual </title>
	
	<link rel="stylesheet" href="http://oocmanual.cogneco.com/css/reset.css">
	<link rel="stylesheet" href="http://oocmanual.cogneco.com/css/text.css">
	<link rel="stylesheet" href="http://oocmanual.cogneco.com/css/color.css">
	<link rel="stylesheet" href="http://oocmanual.cogneco.com/css/layout.css">
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://oocmanual.cogneco.com/apple-touch-icon-144-precomposed.png">
	<link rel="shortcut icon" href="http://oocmanual.cogneco.com/favicon.ico">
	
	<link href="" rel="alternate" type="application/rss+xml" title="The OOC Manual" />
</head>

	<body>
		<header>
  <h1><a href="http://oocmanual.cogneco.com">The OOC Manual</a></h1>
  <p></p>
</header>

		<nav>
	<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/introduction">Introduction</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language">Language</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/modules">Modules</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/values">Values</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/tuples">Tuples</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/control-structures">Control Structures</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/collections">Collections</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/functions">Functions</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/first-class-functions">First-class Functions</a>
		
	</li>
	
</ul>


		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/classes">Classes</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/constructors">Constructors</a>
		
	</li>
	
</ul>


		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/properties">Properties</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/operators">Operators</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/covers">Covers</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/covers-vs-classes">Covers vs Classes</a>
		
	</li>
	
</ul>


		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/enumerations">Enumerations</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/generics">Generics</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/generics2">Generics 2</a>
		
	</li>
	
</ul>


		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/exceptions">Exceptions</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/preprocessor">Preprocessor</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/version-blocks">Version</a>
		
	</li>
	
</ul>


		
	</li>
	
</ul>


		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools">Tools</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock">Rock</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/basic">Basic Usage</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/drivers">Drivers</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/advanced">Advanced Usage</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/use-files">Use-files</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/use-files2">Use-files 2</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/gc">Garbage Collection</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/debug">Debugging</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/packaging">Packaging</a>
		
	</li>
	
</ul>


		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/sam">Sam</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/editors">Editors</a>
		
	</li>
	
</ul>


		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/troubleshooting">Troubleshooting</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk">sdk</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/lang">lang</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/lang/types">types</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/lang/string">string</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/lang/numbers">numbers</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/lang/iterators">iterators</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/lang/exceptions">exception</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/lang/memory">memory</a>
		
	</li>
	
</ul>


		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/structs">structs</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/io">io</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/math">math</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os">os</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/process">process</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/jobpool">jobpool</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/coro">coro</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/terminal">terminal</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/pipe">pipe</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/dynlib">dynlib</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/mmap">mmap</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/channel">channel</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/system">system</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/env">env</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/shellutils">shellutils</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/time">time</a>
		
	</li>
	
</ul>


		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/net">net</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/text">text</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/threading">threading</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/native">native</a>
		
	</li>
	
</ul>


		
	</li>
	
</ul>


</nav>


		<main>
			<header>
				<h1>Version</h1>
			</header>
			<nav id="TableOfContents">
<ul>
<li><a href="#toc_0">Version blocks</a>
<ul>
<li><a href="#toc_1">Syntax</a></li>
<li><a href="#toc_2">Semantics</a></li>
<li><a href="#toc_3">Built-in version names</a></li>
<li><a href="#toc_4">Custom version names</a></li>
<li><a href="#toc_5">Semantics continued</a></li>
<li><a href="#toc_6">Examples</a></li>
<li><a href="#toc_7">Pattern for OS-specific classes</a></li>
</ul></li>
</ul>
</nav>
			<article>
				

<h1 id="toc_0">Version blocks</h1>

<h2 id="toc_1">Syntax</h2>

<p>Version blocks use the following syntax:</p>

<pre><code>    version (&lt;version expression&gt;) {
        &lt;body&gt;
    } else {
        &lt;alternative body&gt;
    }
</code></pre>

<p>Where <version expression> can be any of:</p>

<pre><code>    &lt;version name&gt;
    !&lt;version expression&gt;
    &lt;version expression&gt; &amp;&amp; &lt;version expression&gt;
    &lt;version expression&gt; || &lt;version expression&gt;
</code></pre>

<h2 id="toc_2">Semantics</h2>

<p>Version blocks aren&rsquo;t if-else blocks - they aren&rsquo;t evaluated at runtime.
In rock, version blocks aren&rsquo;t evaluated at ooc-compile-time either.
They&rsquo;re evaluated at C compile time. Which means the C code generated by rock
should be the same on any platform.</p>

<p>Practically, in rock, version blocks are an abstraction for #ifdef / #endif blocks.
The syntax makes it harder to forget to close a version block than an #ifdef / #endif block,
and a few handy aliases (listed below) for commonly used version names are standard, so that developers
don&rsquo;t have to remember the convoluted corresponding C defines.</p>

<p>For other compilers not based on the C language, version block handling may happen at any
stage of the compilation (if any), as long as the version expressions are correctly evaluated
and have the correct meaning (for example, a &lsquo;windows&rsquo; version block should be ignored on OSX)</p>

<h2 id="toc_3">Built-in version names</h2>

<p>C defines are included here for completeness, but are only relevant for people who want
to implement ooc on top of C.</p>

<table>
<thead>
<tr>
<td align="center">Name</td>
<td align="center">corresponding C define</td>
</tr>
</thead>

<tbody>
<tr>
<td align="center">windows</td>
<td align="center"><strong>WIN32</strong></td>
</tr>

<tr>
<td align="center">linux</td>
<td align="center"><strong>linux</strong></td>
</tr>

<tr>
<td align="center">solaris</td>
<td align="center">__sun</td>
</tr>

<tr>
<td align="center">unix</td>
<td align="center"><strong>unix</strong></td>
</tr>

<tr>
<td align="center">beos</td>
<td align="center"><strong>BEOS</strong></td>
</tr>

<tr>
<td align="center">haiku</td>
<td align="center"><strong>HAIKU</strong></td>
</tr>

<tr>
<td align="center">apple</td>
<td align="center"><strong>APPLE</strong></td>
</tr>

<tr>
<td align="center">gnuc</td>
<td align="center"><strong>GNUC</strong></td>
</tr>

<tr>
<td align="center">i386</td>
<td align="center"><strong>i386</strong></td>
</tr>

<tr>
<td align="center">x86</td>
<td align="center"><strong>X86</strong></td>
</tr>

<tr>
<td align="center">x86_64</td>
<td align="center"><strong>x86_64</strong></td>
</tr>

<tr>
<td align="center">ppc</td>
<td align="center"><strong>ppc</strong></td>
</tr>

<tr>
<td align="center">ppc64</td>
<td align="center"><strong>ppc64</strong></td>
</tr>

<tr>
<td align="center">64</td>
<td align="center"><strong>x86_64</strong></td>
</tr>

<tr>
<td align="center">gc</td>
<td align="center"><strong>OOC_USE_GC</strong></td>
</tr>
</tbody>
</table>

<h2 id="toc_4">Custom version names</h2>

<p>Most of the standard version names above depend on your building environment, and the &lsquo;gc&rsquo; name depends
on the compiler setting -gc=[off,static,dynamic].</p>

<p>Custom version names can be used, and turned on/off with the -D and -U compiler flags, for example:</p>

<pre><code>    version(debug) {
        &quot;[%d] Saving database %s&quot; println(timestamp(), db name)
    }
    db save()
</code></pre>

<p>The code inside the version(debug) block will be compiled if -Ddebug is used. It is common practise for ooc developers
to use the -Ddebug switch to debug their applications.</p>

<h2 id="toc_5">Semantics continued</h2>

<p>Version blocks can be used in function bodies, to make certain parts of the code OS-specific, or
they can be used at the mdule-level to make functions or types OS-specific.</p>

<p>If different types are defined in different version blocks, make sure they expose the same interface.
It&rsquo;s not necessary for them to have the exact same class layout, but they should at least have all the
methods/fields that are used in every OS.</p>

<h2 id="toc_6">Examples</h2>

<pre><code>    version(windows) {
        &quot;Hi, Bill!&quot; println()
    }
    version(apple) {
        &quot;Hi, Steve!&quot; println()
    }
    version(linux) {
        &quot;Hi, Linus!&quot; println()
    }
    version(!windows &amp;&amp; !apple &amp;&amp; !linux) {
        &quot;Who are you, and what did you do to my OS?&quot;
    }

    version(apple) {
        &quot;Nice Hardware!&quot; println()
    } else {
        &quot;So you like your computer made of plastic then!&quot; println()
    }
</code></pre>

<p>See also io/File and os/Time in the SDK for real-world examples of heavily versioned code.</p>

<h2 id="toc_7">Pattern for OS-specific classes</h2>

<p>In ooc, &lsquo;new&rsquo; isn&rsquo;t a keyword but a static method. As a result, you can define new yourself.
This allows an interesting pattern for OS-specific classes in ooc:</p>

<pre><code>    // io/File
    import io/[FileUnix, FileWin32]
    
    File: class {
        path: String
    
        new: static func (.path) -&gt; This {
            version(windows) { return FileWin32 new(path) }
            version(unix)    { return FileUnix  new(path) }
            Exception new(This, &quot;Unsupported platform&quot;) throw()
        }
        
        // abstract methods
    }

    // io/FileUnix
    FileUnix: class extends File {
        init: func (=path) {}
        
        // implement abstract methods for unix
    }
    
    // io/FileWin32
    FileWin32: class extends File {
        init: func (=path) {}
        
        // implement abstract methods for Win32
    }
</code></pre>

			</article>
		</main>
		<footer>
  <p></p>
</footer>

	</body>
</html>
