<!DOCTYPE html>
<html>
	<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
	<title> memory &middot; The OOC Manual </title>
	
	<link rel="stylesheet" href="http://oocmanual.cogneco.com/css/reset.css">
	<link rel="stylesheet" href="http://oocmanual.cogneco.com/css/text.css">
	<link rel="stylesheet" href="http://oocmanual.cogneco.com/css/color.css">
	<link rel="stylesheet" href="http://oocmanual.cogneco.com/css/layout.css">
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://oocmanual.cogneco.com/apple-touch-icon-144-precomposed.png">
	<link rel="shortcut icon" href="http://oocmanual.cogneco.com/favicon.ico">
	
	<link href="" rel="alternate" type="application/rss+xml" title="The OOC Manual" />
</head>

	<body>
		<header>
  <h1><a href="http://oocmanual.cogneco.com">The OOC Manual</a></h1>
  <p></p>
</header>

		<nav>
	<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/introduction/">Introduction</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/installing/">Installing</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/">Language</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/modules/">Modules</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/values/">Values</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/tuples/">Tuples</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/control-structures/">Control Structures</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/collections/">Collections</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/functions/">Functions</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/first-class-functions/">First-class Functions</a>
		
	</li>
	
</ul>

		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/classes/">Classes</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/constructors/">Constructors</a>
		
	</li>
	
</ul>

		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/properties/">Properties</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/operators/">Operators</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/interfaces/">Interfaces</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/covers/">Covers</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/covers-vs-classes/">Covers vs Classes</a>
		
	</li>
	
</ul>

		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/enumerations/">Enumerations</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/generics/">Generics</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/generics2/">Generics 2</a>
		
	</li>
	
</ul>

		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/exceptions/">Exceptions</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/preprocessor/">Preprocessor</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/language/version-blocks/">Version</a>
		
	</li>
	
</ul>

		
	</li>
	
</ul>

		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/">sdk</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/lang/">lang</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/lang/types/">types</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/lang/string/">string</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/lang/numbers/">numbers</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/lang/iterators/">iterators</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/lang/exceptions/">exception</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/lang/memory/">memory</a>
		
	</li>
	
</ul>

		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/structs/">structs</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/io/">io</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/math/">math</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/">os</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/process/">process</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/jobpool/">jobpool</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/coro/">coro</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/terminal/">terminal</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/pipe/">pipe</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/dynlib/">dynlib</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/mmap/">mmap</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/channel/">channel</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/system/">system</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/env/">env</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/shellutils/">shellutils</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/os/time/">time</a>
		
	</li>
	
</ul>

		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/net/">net</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/text/">text</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/threading/">threading</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/sdk/native/">native</a>
		
	</li>
	
</ul>

		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/">Tools</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/">Rock</a>
		
		<ul>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/basic/">Basic Usage</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/drivers/">Drivers</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/advanced/">Advanced Usage</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/use-files/">Use-files</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/use-files2/">Use-files 2</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/gc/">Garbage Collection</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/debug/">Debugging</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/rock/packaging/">Packaging</a>
		
	</li>
	
</ul>

		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/sam/">Sam</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/tools/editors/">Editors</a>
		
	</li>
	
</ul>

		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/troubleshooting/">Troubleshooting</a>
		
	</li>
	
	<li>
		<a href="http://oocmanual.cogneco.com/glossary/">Glossary</a>
		
	</li>
	
</ul>

</nav>

		<main>
			<header>
				<h1>memory</h1>
			</header>
			<nav id="TableOfContents">
<ul>
<li><a href="#toc_0">Memory</a>
<ul>
<li><a href="#toc_1">Allocating memory</a></li>
<li><a href="#toc_2">Allocating in bulks</a></li>
<li><a href="#toc_3">Re-allocating memory</a></li>
<li><a href="#toc_4">Duplicating memory</a></li>
<li><a href="#toc_5">Freeing memory</a></li>
</ul></li>
</ul>
</nav>
			<article>
				

<h1 id="toc_0">Memory</h1>

<p>Sometimes, you just have to handle memory yourself. None of that class
or cover stuff, just give me a raw block of memory any day.</p>

<p>You&rsquo;ll see the <code>gc_</code> prefix being used in the following page: that stands
for Garbage Collection, which is enabled by default in ooc. However, when
the GC is disabled, those will point to non-GC version of the functions.</p>

<p>So that your code remains flexible, do yourself a favor and use the <code>gc_</code>
variants regardless.</p>

<h2 id="toc_1">Allocating memory</h2>

<p>Use <code>gc_malloc</code> to get a chunk of memory all to yourself.</p>

<pre><code>#!ooc
// get ourselves a slice of 4 bytes
block := gc_malloc(4)
</code></pre>

<p>However, you&rsquo;ll get a <code>Pointer</code> back - which is a little bit pointless.
Plus you&rsquo;ll probably want to determine how much you are allocating as
a function of the size of some other type instead:</p>

<pre><code>#!ooc
// get ourselves room to store 4 doubles.
doubles := gc_malloc(4 * Double size) as Double*
</code></pre>

<p>That&rsquo;s better. Now you can index that, like any pointer:</p>

<pre><code>#!ooc
doubles[0] = 3.14
doubles[1] = 6.28
// etc.
</code></pre>

<p>Pointer arithmetic works:</p>

<pre><code>#!ooc
addressOfSecondDouble := doubles + 1
</code></pre>

<p>Then again, why not write it the explicit way:</p>

<pre><code>#!ooc
addressOfSecondDouble := doubles[1]&amp;
</code></pre>

<p>Note that <code>gc_malloc</code> returns zeroed memory (even when the GC is disabled),
just like the C function <code>calloc</code> does. While a small performance hit, a
little additional safety can&rsquo;t hurt.</p>

<h2 id="toc_2">Allocating in bulks</h2>

<p><code>calloc</code> is typically used in C to get zeroed memory (e.g. all null bytes).
This is unnecessary in ooc, since <code>gc_malloc</code> returns zeroed memory anyway.</p>

<p>In the rare cases where you do mean to allocate <code>num</code> members of size <code>size</code>,
use <code>gc_calloc</code>:</p>

<pre><code>#!ooc
members := gc_calloc(num, size)
</code></pre>

<h2 id="toc_3">Re-allocating memory</h2>

<p>Didn&rsquo;t get enough the first time around? Misjudged your budget needs?</p>

<p>Fear not, <code>gc_realloc</code> is here:</p>

<pre><code>#!ooc
// get ourselves 4 bytes
block := gc_malloc(4)

// woops, make that 8
block = gc_realloc(block, 8)
</code></pre>

<h2 id="toc_4">Duplicating memory</h2>

<p>In our family of memory-related functions, <code>gc_strdup</code>, nostalgically
named as if it was only used with strings, is here. It&rsquo;ll make a copy of
a block of memory so that the original may be disposed of.</p>

<pre><code>#!ooc
someCallback: func (word: CString) {
  // CString is a pointer to a memory block that will get
  // overriden sometimes after this function returns - hence,
  // we want to make a copy so that the data we got doesn't
  // get tampered with.
  storeString(String new(gc_strdup(word)))
}
</code></pre>

<p>The block of code above shows the typical use case, anyway.</p>

<h2 id="toc_5">Freeing memory</h2>

<p>Technically, since we are using a garbage collector, you don&rsquo;t need to
free explicitly. Should you feel the need to do so, however, <code>gc_free</code> is
here to do the job:</p>

<pre><code>#!ooc
// you know what, I'm good for now, thanks.
gc_free(block)
</code></pre>

			</article>
			<footer>
				<p><span id="footer-copyright">2009-2014 Amos Wenger</span><span id="footer-license">CC BY-SA 3.0</span></p>
			</footer>
		</main>
		<footer>
  <p></p>
</footer>

	</body>
</html>
